import{a as De,b as Le}from"./chunk-4LXP3TMW.js";import{a as Me,b as O,c as U,d as Ne}from"./chunk-JPRJCQ7A.js";import{a as V,b as W}from"./chunk-IHMPC7RH.js";import{b as Fe}from"./chunk-CJTN6TSS.js";import{a as ke}from"./chunk-J5REKJTI.js";import{b as Ie}from"./chunk-A6E5FFHP.js";import{a as Ve,b as Te}from"./chunk-52VFGFI6.js";import{b as _e,c as ge,f as fe,h as Ce,i as he,j as ve,k as xe,m as Se,n as be}from"./chunk-RMR25O2K.js";import{a as Pe,b as we}from"./chunk-36NSVSE4.js";import{$ as ue,I as re,J as ne,K as oe,L as le,P as se,T as ce,U as A,_ as ae,p as G,ta as me,ua as de,v as ee,w as te,y as ie}from"./chunk-ETPUSV7N.js";import{c as B}from"./chunk-DKLNZNMU.js";import{a as pe}from"./chunk-NFNWDAVZ.js";import{b as Re}from"./chunk-OKGYADQP.js";import{a as ye}from"./chunk-PTMIGOEM.js";import{a as Ee}from"./chunk-PWEKJSU7.js";import{b as X,d as Y,e as Z}from"./chunk-EVAI7AMW.js";import{Cb as m,Ib as F,Kb as z,Lb as H,Mb as j,Nb as o,Nd as J,Ob as l,Od as K,Pb as C,Qb as M,Rb as D,Sb as E,Tb as x,Wb as f,Wd as N,Yb as c,ec as R,fc as u,ga as _,gb as n,gc as v,hc as y,ka as q,ke as Q,lc as b,mc as P,nc as w,pc as $,va as d,vc as L,wa as p,wb as g,xa as h,xb as I,ya as S,yb as k}from"./chunk-BXK32XEB.js";var Be=()=>[A,N,G,Z,ue,ae,me,B],Ge=()=>[N];function Ae(r,a){if(r&1){let i=x();o(0,"c-nav-item",4)(1,"button",12),f("click",function(){d(i);let t=c(2);return p(t.retour())}),u(2,"Return"),l()()}if(r&2){let i=c(2);n(),m("routerLink",i.returnUrl)}}function We(r,a){r&1&&C(0,"c-spinner",9)}function Oe(r,a){r&1&&(h(),C(0,"svg",10))}function Ue(r,a){r&1&&E(0)}function qe(r,a){r&1&&E(0)}function ze(r,a){if(r&1){let i=x();o(0,"c-row",2)(1,"c-nav",3),g(2,Ae,3,1,"c-nav-item",4),o(3,"c-nav-item",5)(4,"button",6),f("click",function(){d(i);let t=c();return p(t.cancel())}),u(5,`
Annuler
`),l()(),o(6,"c-nav-item",4)(7,"button",7),f("click",function(){d(i);let t=c();return p(t.reset())}),u(8,"Reset"),l()(),o(9,"c-nav-item",4)(10,"button",8),f("click",function(){d(i);let t=c();return p(t.create())}),g(11,We,1,0,"c-spinner",9)(12,Oe,1,0,":svg:svg",10),u(13,`
Cr\xE9er
`),l()()()(),g(14,Ue,1,0,"ng-container",11)(15,qe,1,0,"ng-container",11)}if(r&2){let i=c(),e=R(7),t=R(9);n(2),F(i.toReturn?2:-1),n(9),F(i.sending?11:12),n(3),m("ngTemplateOutlet",e),n(),m("ngTemplateOutlet",t)}}function He(r,a){r&1&&E(0)}function je(r,a){if(r&1&&g(0,He,1,0,"ng-container",11),r&2){c();let i=R(7);m("ngTemplateOutlet",i)}}function $e(r,a){if(r&1){let i=x();o(0,"c-col",15),h(),C(1,"svg",24),S(),o(2,"label",25),u(3,"Client"),l(),o(4,"c-input-group")(5,"input",26),w("ngModelChange",function(t){d(i);let s=c(2);return P(s._clientName,t)||(s._clientName=t),p(t)}),f("blur",function(){d(i);let t=c(2);return p(t.validator.client.validate())}),l(),o(6,"button",27),f("click",function(){d(i);let t=c(2);return p(t.navigateToClientCreate())}),h(),C(7,"svg",10),l(),S(),o(8,"c-form-feedback",19),u(9),l()()()}if(r&2){let i=c(2);n(5),b("ngModel",i._clientName),m("valid",i.validator.client.valid),n(3),m("valid",!1),n(),v(i.validator.client.message)}}function Je(r,a){if(r&1&&(o(0,"option",30),u(1),l()),r&2){let i=a.$implicit;m("ngValue",i),n(),v(i.nom)}}function Ke(r,a){if(r&1){let i=x();o(0,"c-col",15),h(),C(1,"svg",24),S(),o(2,"label",25),u(3,"Client"),l(),o(4,"c-input-group")(5,"select",28),w("ngModelChange",function(t){d(i);let s=c(2);return P(s.client,t)||(s.client=t),p(t)}),f("blur",function(){d(i);let t=c(2);return p(t.validator.client.validate())}),g(6,Je,2,2,"option",29),l(),o(7,"button",27),f("click",function(){d(i);let t=c(2);return p(t.navigateToClientCreate())}),h(),C(8,"svg",10),l(),S(),o(9,"c-form-feedback",19),u(10),l()()()}if(r&2){let i=c(2);n(5),b("ngModel",i.client),m("valid",i.validator.client.valid),n(),m("ngForOf",i.clientList),n(3),m("valid",!1),n(),v(i.validator.client.message)}}function Qe(r,a){if(r&1){let i=x();o(0,"c-card",13)(1,"c-card-body")(2,"c-row",14)(3,"c-col",15),h(),C(4,"svg",16),S(),o(5,"label",17),u(6,"Code"),l(),o(7,"input",18),w("ngModelChange",function(t){d(i);let s=c();return P(s.item.code,t)||(s.item.code=t),p(t)}),f("blur",function(){d(i);let t=c();return p(t.validator.code.validate())}),l(),o(8,"c-form-feedback",19),u(9),l()(),g(10,$e,10,4,"c-col",20)(11,Ke,11,5,"c-col",20),o(12,"c-col",15),h(),C(13,"svg",21),S(),o(14,"label",22),u(15,"Entreprise"),l(),C(16,"input",23),l()()()()}if(r&2){let i=c();n(7),b("ngModel",i.item.code),m("valid",i.validator.code.valid),n(),m("valid",!1),n(),v(i.validator.code.message),n(),m("ngIf",i.isClient),n(),m("ngIf",!i.isClient),n(5),m("value",i.item.entreprise==null?null:i.item.entreprise.nom)}}function Xe(r,a){if(r&1&&(o(0,"td"),u(1),l()),r&2){let i=c(4);n(),y(" ",i.disponible2,"")}}function Ye(r,a){if(r&1&&(o(0,"td"),u(1),l()),r&2){let i=c().$implicit;n(),y(" ",i.disponible,"")}}function Ze(r,a){if(r&1){let i=x();o(0,"tr")(1,"td"),u(2),l(),o(3,"td"),u(4),l(),o(5,"td")(6,"input",38),w("ngModelChange",function(t){let s=d(i).$implicit;return P(s.quantite,t)||(s.quantite=t),p(t)}),f("ngModelChange",function(t){let s=d(i).$implicit,T=c(3);return p(T.updateDisponible(s,t))}),l()(),g(7,Xe,2,1,"td",35)(8,Ye,2,1,"td",35),o(9,"td",39)(10,"button",40),f("click",function(){let t=d(i).$implicit,s=c(3);return p(s.deletefactureProduit(t))}),h(),C(11,"svg",41),l()()()}if(r&2){let i=a.$implicit,e=c(3);n(2),v(i.produit!=null?i.produit.nom:"null"),n(2),v(i.prix),n(2),b("ngModel",i.quantite),n(),m("ngIf",e.disponible2),n(),m("ngIf",e.disponible2==0)}}function et(r,a){if(r&1&&(M(0),g(1,Ze,12,5,"tr",37),D()),r&2){let i=c(2);n(),m("ngForOf",i.facturee.factureProduit)}}function tt(r,a){if(r&1&&(o(0,"td"),u(1),l()),r&2){let i=c(4);n(),y(" ",i.disponible2,"")}}function it(r,a){if(r&1&&(o(0,"td"),u(1),l()),r&2){let i=c().$implicit;n(),y(" ",i.disponible,"")}}function rt(r,a){if(r&1){let i=x();o(0,"tr")(1,"td"),u(2),l(),o(3,"td"),u(4),l(),o(5,"td")(6,"input",38),w("ngModelChange",function(t){let s=d(i).$implicit;return P(s.quantite,t)||(s.quantite=t),p(t)}),f("ngModelChange",function(t){let s=d(i).$implicit,T=c(3);return p(T.updateDisponible(s,t))}),l()(),g(7,tt,2,1,"td",35)(8,it,2,1,"td",35),o(9,"td",39)(10,"button",40),f("click",function(){let t=d(i).$implicit,s=c(3);return p(s.deleteretourProduitProduit(t))}),h(),C(11,"svg",41),l()()()}if(r&2){let i=a.$implicit,e=c(3);n(2),v(i==null||i.produit==null?null:i.produit.nom),n(2),v(i.prix),n(2),b("ngModel",i.quantite),n(),m("ngIf",e.disponible2),n(),m("ngIf",e.disponible2==0)}}function nt(r,a){if(r&1&&(M(0),g(1,rt,12,5,"tr",37),D()),r&2){let i=c(2);n(),m("ngForOf",i.retourProduitProduit)}}function ot(r,a){if(r&1&&(o(0,"option",30),u(1),l()),r&2){let i=a.$implicit;m("ngValue",i),n(),v(i.nom)}}function lt(r,a){if(r&1){let i=x();o(0,"c-col",42)(1,"c-input-group")(2,"select",43),f("ngModelChange",function(t){d(i);let s=c(2);return p(s.addretourProduitProuits(t))}),H(3,ot,2,2,"option",30,z),l()()()}if(r&2){let i=c(2);n(3),j(i.produitList)}}function st(r,a){if(r&1&&(o(0,"c-card",13)(1,"c-card-header")(2,"strong"),u(3,"S\xE9lectionner des produits"),l()(),o(4,"c-card-body")(5,"table",31)(6,"thead",32)(7,"tr")(8,"th",33),u(9,"Produit"),l(),o(10,"th",33),u(11,"Prix"),l(),o(12,"th",33),u(13,"Quantit\xE9"),l(),o(14,"th",33),u(15,"Disponible"),l(),o(16,"th",34),u(17,"Actions"),l()()(),o(18,"tbody"),g(19,et,2,1,"ng-container",35)(20,nt,2,1,"ng-container",35),l()(),g(21,lt,5,0,"c-col",36),l()()),r&2){let i=c();n(5),m("hover",!0)("responsive",!0)("striped",!0),n(14),m("ngIf",i.isClient),n(),m("ngIf",!i.isClient),n(),m("ngIf",!i.isClient)}}var Ut=(()=>{let a=class a{constructor(){this.sending=!1,this.standAlon=!0,this.router=_(Y),this.service=_(W),this.clientService=_(Te),this.employeService=_(Re),this.entrepriseService=_(we),this.formBuilder=_(Se),this.factureService=_(Fe),this.retourService=_(W),this.produitService=_(Ie),this.retourProduitProduitService=_(Le),this.toasterService=_(ke),this.entrepriseSelectedService=_(ye),this.userInfosService=_(Ee),this.tokenService=_(pe),this.route=_(X),this.validator=Me.init(()=>this.item),this._clientName=this.item.client?.nom??"",this.disponible2=0,this.currentCodeNumber=1,this.noteCreditGetter=()=>this.noteCredit,this.noteCreditSetter=e=>this.noteCredit=e,this.remboursementsGetter=()=>this.remboursements,this.remboursementsSetter=e=>this.remboursements=e,this.statutRetourProduitEnumList=Object.values(Ne)}set setItemGetter(e){this.itemGetter=e,this.standAlon=!1}set setItemSetter(e){this.itemSetter=e}set setValidator(e){this.validator=e}ngOnInit(){if(this.route.queryParams.subscribe(t=>{this.idFacture=+t.idFacture,this.factureService.findById(this.idFacture).subscribe({next:s=>{this.facturee=s,this.facturee&&this.facturee.client&&this.facturee.factureProduit?(this.item.client=this.facturee.client,this.item.client&&(this.isClient=!0),this.item.client.nom?this._clientName=this.item.client?.nom:console.error("Name of Client is undefined or facture is undefined")):console.error("Client is undefined or facture is undefined")},error:s=>console.log(s)})}),this.loadEntreprise(),this.service.keepData){let t=this.clientService.createdItemAfterReturn;t.created&&(this.item.client=t.item,this.validator.client.validate())}else this.reset(!1);this.service.keepData=!1,this.item.noteCredit=new O,this.item.remboursements=new U,this.loadEntrepriseList(),this.factureretour(),this.loadProduitList(),(this.tokenService.getRole()?.some(t=>t=="ADMIN")?1:0)==1?this.getClientsForAdmin():this.getClientsForEmploye(),this.clientForm=this.formBuilder.group({code:[{value:this.generateCode(),disabled:!0}]}),this.service.getNextCode().subscribe({next:t=>this.item.code=t.code,error:t=>console.log(t)})}generateCode(){return"I"+this.currentCodeNumber.toString().padStart(7,"0")}updateDisponible(e,t){e.disponible&&e.disponible>0?this.disponible2=e.disponible-t:e.quantite=t}loadEntreprise(){this.entrepriseService.findById(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:e=>{this.item.entreprise=e,console.log("entre :",this.item.entreprise)},error:e=>console.log(e)})}loadProduitList(){this.produitService.findByEntrepriseId(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:e=>this.produitList=e,error:e=>console.log(e)})}factureretour(){this.service.findByFactureId(this.itemF.id).subscribe({next:e=>{this.item=e},error:e=>{console.log(e)}})}deleteretourProduitProduit(e){this.item.retourProduitProduit=this.item.retourProduitProduit?.filter(t=>t!==e)}deletefactureProduit(e){this.facturee.factureProduit=this.facturee.factureProduit?.filter(t=>t!==e)}get retourProduitProduit(){return this.item.retourProduitProduit==null&&(this.item.retourProduitProduit=[]),this.item.retourProduitProduit}getClientsForAdmin(){this.entrepriseSelectedService.getEntrepriseSelected()!=0?this.clientService.getClients(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:e=>{this.clientList=e,console.log("Clients :",e)},error:e=>console.log(e)}):this.entrepriseService.findByAdmin(this.userInfosService.getUsername()).subscribe(e=>{this.entreprises=e,console.log("Entreprises: ",this.entreprises),this.entreprises&&this.entreprises.length>0?this.clientService.getClients(this.entreprises[0].id).subscribe({next:t=>{this.clientList=t,console.log("Clients :",t)},error:t=>console.log(t)}):console.log("Aucune entreprise trouv\xE9e.")},e=>{console.log(e)})}getClientsForEmploye(){this.entrepriseSelectedService.getEntrepriseSelected()!=0?this.clientService.getClients(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:e=>{this.clientList=e,console.log("Clients :",e)},error:e=>console.log(e)}):this.employeService.findByUserName(this.userInfosService.getUsername()).subscribe(e=>{console.log("empId: ",e.id),this.entrepriseService.findEntreprisesAdroitAcces(e.id).subscribe(t=>{this.entreprises=t,console.log("Entreprises\xC0droit: ",this.entreprises),this.entreprises&&this.entreprises.length>0&&this.clientService.getClients(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:s=>{this.clientList=s,console.log("Clients :",s)},error:s=>console.log(s)})},t=>{console.log(t)})},e=>{console.log(e)})}loadEntrepriseList(){this.entrepriseService.findById(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:e=>{this.item.entreprise=e,console.log("entre :",this.item.entreprise)},error:e=>console.log(e)})}get itemRP(){return this.retourProduitProduitService.item}set itemRP(e){this.retourProduitProduitService.item=e}create(){console.log(this.item),this.validator.validate()&&(this.sending=!0,this.service.create().subscribe({next:e=>{if(this.sending=!1,e!=null){if(this.toReturn){this.item=e,this.router.navigate([this.returnUrl]).then();return}this.item=new V,this.router.navigate(["/ventes/retourproduit/retour-produit"]).then(),this.toasterService.toast({message:"Un nouveau retour de produit a \xE9t\xE9 ajout\xE9",color:"success"})}},error:e=>{this.sending=!1,console.log(e),this.validator.import(e.error)}}))}addretourProduitProuits(e){console.log(e),this.item.retourProduitProduit==null&&(this.item.retourProduitProduit=[]);let t=new De;t.produit=e,console.log("produit",e),t.quantite=0,e.disponible=e?.niveauStockInitial-t?.quantite,console.log("disponible",e.disponible),t.disponible=e?.niveauStockInitial-t?.quantite,console.log(t.disponible),t.prix=e?.produitNiveauPrix?.filter(s=>s.niveauPrix?.id==this.client?.niveauPrix?.id)[0]?.prix||e.prixGros,console.log("client",this.client),console.log("niveau prix du client",this?.client.niveauPrix),console.log(t.prix),console.log(t.total),this.item.retourProduitProduit=[...this.item.retourProduitProduit,t],console.log(this.item.retourProduitProduit)}reset(e=!0){(e||this.item==null)&&(this.item=new V),this.validator.reset()}get items(){return this.service.items}set items(e){this.service.items=e}get item(){return this.itemGetter()}get itemF(){return this.itemGetterF()}set item(e){this.itemSetter(e)}itemGetter(){return this.service.item}itemGetterF(){return this.factureService.item}itemSetter(e){this.service.item=e}get noteCredit(){return this.item.noteCredit==null&&(this.item.noteCredit=new O),this.item.noteCredit}set noteCredit(e){this.item.noteCredit=e}get remboursements(){return this.item.remboursements==null&&(this.item.remboursements=new U),this.item.remboursements}set remboursements(e){this.item.remboursements=e}get client(){return this.item.client==null&&(this.item.client=new Ve),this.item.client}set client(e){this.item.client=e}get entreprise(){return this.item.entreprise==null&&(this.item.entreprise=new Pe),this.item.entreprise}set entreprise(e){this.item.entreprise=e}get returnUrl(){return this.service.returnUrl}get toReturn(){return this.service.toReturn()}navigateToClientCreate(){this.clientService.returnUrl=this.router.url,this.service.keepData=!0,this.router.navigate(["/contacts/client/create"]).then()}navigateToEntrepriseCreate(){this.entrepriseService.returnUrl=this.router.url,this.service.keepData=!0,this.router.navigate(["/parametres/entreprise/create"]).then()}cancel(){this.item=new V}retour(){this.router.navigate(["/pays/pays/list"]).then()}get facture(){return this.retourService.facture}};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=q({type:a,selectors:[["app-retour-produit-create"]],inputs:{setItemGetter:[0,"getter","setItemGetter"],setItemSetter:[0,"setter","setItemSetter"],setValidator:[0,"validator","setValidator"]},standalone:!0,features:[$],decls:10,vars:2,consts:[["createFrom",""],["devisProduitCreate",""],[0,"xmlns","border-radius","http://www.w3.org/1999/xhtml",0,"xmlns","border-radius","http://www.w3.org/1999/xhtml",1,"mb-3"],[1,"hstack","gap"],[1,"p-2"],[1,"p-2","ms-auto"],["cButton","","color","secondary","variant","outline","routerLink","/ventes/facture/facture",3,"click"],["cButton","","color","dark",3,"click"],["cButton","","color","primary",3,"click"],["aria-hidden","true","size","sm"],["cIcon","","name","cilPlus"],[4,"ngTemplateOutlet"],["cButton","","color","secondary",3,"click","routerLink"],[1,"mb-3"],[1,"g-3"],["sm","4"],["cIcon","","name","cil-barcode",2,"color","blue","font-size","30px"],["cLabel","","for","code",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","code","type","text","placeholder","Code","name","code",3,"ngModelChange","blur","ngModel","valid"],[3,"valid"],["sm","4",4,"ngIf"],["cIcon","","name","cil-building",2,"color","blue","font-size","30px"],["cLabel","","for","entreprise",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","entreprise","type","text","name","entreprise","disabled","true",3,"value"],["cIcon","","name","cilUser",2,"color","blue","font-size","30px"],["cLabel","","for","client",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","client1","type","text","name","client",3,"ngModelChange","blur","ngModel","valid"],["cButton","","color","secondary","type","button","variant","outline",3,"click"],["cSelect","","id","client","name","client",3,"ngModelChange","blur","ngModel","valid"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],["align","middle","cTable","",1,"mb-0","border",3,"hover","responsive","striped"],[1,"text-nowrap","text-truncate"],[1,"bg-body-tertiary"],[1,"bg-body-tertiary",2,"display","flex","justify-content","end"],[4,"ngIf"],["sm","3","class","mt-3",4,"ngIf"],[4,"ngFor","ngForOf"],["type","number",3,"ngModelChange","ngModel"],[2,"display","flex","justify-content","end"],["cButton","","color","",3,"click"],["cIcon","","name","cil-trash","size","lg"],["sm","3",1,"mt-3"],["cSelect","","ngModel","",3,"ngModelChange"]],template:function(t,s){t&1&&(g(0,ze,16,4),I(1,0,Be),g(3,je,1,1),I(4,3,Ge),g(6,Qe,17,7,"ng-template",null,0,L)(8,st,22,6,"ng-template",null,1,L)),t&2&&(n(),k(s.standAlon),n(3),k(!s.standAlon))},dependencies:[oe,A,ce,se,be,ve,xe,_e,Ce,he,ge,fe,le,ee,te,ie,ne,G,B,re,de,Q,J,K]});let r=a;return r})();export{Ut as a};
