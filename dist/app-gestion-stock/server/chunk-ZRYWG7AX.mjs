import './polyfills.server.mjs';
import{a as d}from"./chunk-YN4AEEQH.mjs";import{b as v}from"./chunk-YBXQW75Z.mjs";import{a as _}from"./chunk-XWMWN5XG.mjs";import{a as g}from"./chunk-ENKAC57S.mjs";import{e as y}from"./chunk-GFB74FXC.mjs";import{a as f,b as u}from"./chunk-YCIOFEEA.mjs";import{D as a,Y as m,aa as h,ga as s}from"./chunk-VWPO2VC4.mjs";var A=(()=>{let o=class o{constructor(){this._tokenService=s(d),this._router=s(y),this._loading=!1,this.employeService=s(v),this._userInfosService=s(_),this.api=g.apiUrl+"notifications",this._http=s(u),this._keepData=!1,this._returnUrl="",this.iSemploye=0,this._toReturn=()=>this._returnUrl!=null}findAll(e){return this._http.get(`${this.api}/${e}`)}delete(e){let t=`${this.api}`,n={headers:new f({"Content-Type":"application/json"}),body:e};return this._http.delete(t,n)}createNotification(e,t,n,r,p){let i={type:e,message:t,nomEmploye:n,employe:r,entrepriseId:p};return console.log("Notification to be sent:",i),this._http.post(this.api,i).pipe(m(l=>{console.log("Response from API:",l)}),a(l=>{throw console.error("Error from API:",l),l}))}handelcreate(e,t,n){this.iSemploye=this.isEmploye,console.log(this.iSemploye),this.iSemploye==1?(console.log("User is an employe"),this.getEmployeByUsername().subscribe({next:r=>{let p=r?.nom||"Nom Inconnu";this.createNotification(e,t,p,r,n).subscribe({next:i=>{console.log("Notification envoy\xE9e avec succ\xE8s",i)},error:i=>{console.error("Erreur lors de l'envoi de la notification",i)}})},error:r=>{console.error("Erreur lors de la r\xE9cup\xE9ration de l'employ\xE9 pour la notification",r)}})):console.log("User is not an employe")}get isEmploye(){return this._tokenService.getRole()?.some(t=>t=="EMPLOYE")?1:0}getEmployeByUsername(){return this._loading=!0,this.employeService.findByUserName(this._userInfosService.getUsername()).pipe(m(e=>{this.employe=e,console.log("Employ\xE9 r\xE9cup\xE9r\xE9:",this.employe),this._loading=!1}),a(e=>{throw console.error("Erreur lors de la r\xE9cup\xE9ration de l'employ\xE9:",e),this._loading=!1,e}))}get item(){return this._item}set item(e){this._item=e}get items(){return this._items}set items(e){this._items=e}};o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();export{A as a};
