import './polyfills.server.mjs';
import{a as Ke,b as Xe}from"./chunk-WQJ5A5RX.mjs";import{b as Qe}from"./chunk-YI7DQ4LI.mjs";import{a as N}from"./chunk-M25OBH6Z.mjs";import{a as Ye}from"./chunk-3GJOX54U.mjs";import{a as j}from"./chunk-HXC2Y4JH.mjs";import{a as $,b as je}from"./chunk-GQ7BGXIS.mjs";import{a as Je}from"./chunk-OR4ZYGNA.mjs";import{a as H}from"./chunk-EAIC5JXJ.mjs";import{b as Ne}from"./chunk-2IZGWHSK.mjs";import{b as ze}from"./chunk-PZO4XLW5.mjs";import{a as Ge,b as We}from"./chunk-NXGTTB3I.mjs";import{a as Ae,b as Be}from"./chunk-4O54P57Y.mjs";import{a as Oe,b as He}from"./chunk-QVGIFFSU.mjs";import{a as qe,b as Ue}from"./chunk-AHRJE2FH.mjs";import{a as O,b as $e}from"./chunk-XXWZ3SQU.mjs";import{a as R}from"./chunk-TQMIRSZL.mjs";import{a as _e}from"./chunk-GYJGDPFA.mjs";import{a as Ie,b as Me}from"./chunk-KUWVGZID.mjs";import{b as ge,c as Ce,f as be,h as Se,i as ye,j as Ee,k as we,l as Te,m as Fe,n as Pe}from"./chunk-MG5ECMPI.mjs";import{B as oe,C as le,D as se,E as ce,I as me,M as de,N as U,T as pe,U as ue,i as q,ma as he,na as ve,o as re,p as ne,r as ae}from"./chunk-BJSQRMLK.mjs";import{c as z}from"./chunk-TMD5LWM3.mjs";import{a as De}from"./chunk-MHGFRO2M.mjs";import{a as fe}from"./chunk-JCP3ZGLC.mjs";import{b as Le}from"./chunk-TJ3A5ET5.mjs";import{a as ke}from"./chunk-NLO6QWTG.mjs";import{a as Re}from"./chunk-WHNHYHSL.mjs";import{a as Ve}from"./chunk-FO7JI6NW.mjs";import{a as xe}from"./chunk-ENKAC57S.mjs";import{e as te,f as ie}from"./chunk-AO72HDTW.mjs";import{b as ee}from"./chunk-OCP4HJ6B.mjs";import{Ab as B,Eb as m,Kb as G,Mb as P,Nb as V,Ob as I,Pb as r,Qb as a,Rb as v,Ub as L,Vb as k,Yb as f,_b as d,aa as Y,ga as h,gc as D,hb as o,hc as s,ic as _,jc as X,ka as J,nc as E,oc as w,pc as T,rc as Z,ua as K,va as p,wa as u,xa as g,xc as W,ya as C,yb as F,zb as A}from"./chunk-NYO24GET.mjs";var Ze=(()=>{let c=class c{constructor(){this.api=xe.apiUrl+"produitniveauPrix",this.http=h(ee),this.keepData=!1,this.toReturn=()=>this.returnUrl!=null}findAll(){return this.http.get(this.api)}findById(e){return this.http.get(`${this.api}/id/${e}`)}findAllOptimized(){return this.http.get(`${this.api}/optimized`)}findPaginated(e=0,t=10){return this.http.get(`${this.api}/paginated?page=${e}&size=${t}`)}create(){return this.http.post(this.api,this.item)}createList(){return this.http.post(`${this.api}/all`,this.items)}update(){return this.http.put(this.api,this.item)}updateList(){return this.http.put(`${this.api}/all`,this.items)}delete(e){return this.http.delete(this.api,{body:e})}deleteAll(e){return this.http.delete(this.api,{body:e})}deleteById(e){return this.http.delete(`${this.api}/id/${e}`)}deleteByProduitId(e){return this.http.delete(`${this.api}/produit/${e}`)}findByProduitId(e){return this.http.get(`${this.api}/produit/id/${e}`)}deleteByNiveauPrixId(e){return this.http.delete(`${this.api}/niveauPrix/${e}`)}findByNiveauPrixId(e){return this.http.get(`${this.api}/niveauPrix/${e}`)}get itemIsNull(){return this._item==null}get items(){return this._items==null&&(this._items=[]),this._items}get pagination(){return this._pagination==null&&(this._pagination=new Ve),this._pagination}set pagination(e){this._pagination=e}set items(e){this._items=e}get item(){return this._item==null&&(this._item=new H),this._item}set item(e){this._item=e}get createdItemAfterReturn(){let e={item:this.item,created:this.toReturn()};return this.returnUrl="",this.item=new H,e}};c.\u0275fac=function(t){return new(t||c)},c.\u0275prov=Y({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();var tt=()=>[U,import("./chunk-FBVZH4FD.mjs").then(l=>l.NgTemplateOutlet),q,ie,ue,pe,he,z],it=()=>[import("./chunk-FBVZH4FD.mjs").then(l=>l.NgTemplateOutlet)];function rt(l,c){if(l&1){let i=k();r(0,"c-nav-item",4)(1,"button",12),f("click",function(){p(i);let t=d(2);return u(t.retour())}),s(2,"Return"),a()()}if(l&2){let i=d(2);o(),m("routerLink",i.returnUrl)}}function nt(l,c){l&1&&v(0,"c-spinner",9)}function at(l,c){l&1&&(g(),v(0,"svg",10))}function ot(l,c){l&1&&L(0)}function lt(l,c){l&1&&L(0)}function st(l,c){if(l&1){let i=k();r(0,"c-row",2)(1,"c-nav",3),F(2,rt,3,1,"c-nav-item",4),r(3,"c-nav-item",5)(4,"button",6),f("click",function(){p(i);let t=d();return u(t.cancel())}),s(5,`
Annuler
`),a()(),r(6,"c-nav-item",4)(7,"button",7),f("click",function(){p(i);let t=d();return u(t.reset())}),s(8,"Reset"),a()(),r(9,"c-nav-item",4)(10,"button",8),f("click",function(){p(i);let t=d();return u(t.create())}),F(11,nt,1,0,"c-spinner",9)(12,at,1,0,":svg:svg",10),s(13,`
Cr\xE9er
`),a()()()(),F(14,ot,1,0,"ng-container",11)(15,lt,1,0,"ng-container",11)}if(l&2){let i=d(),e=D(7),t=D(9);o(2),G(i.toReturn?2:-1),o(9),G(i.sending?11:12),o(3),m("ngTemplateOutlet",e),o(),m("ngTemplateOutlet",t)}}function ct(l,c){l&1&&L(0)}function mt(l,c){if(l&1&&F(0,ct,1,0,"ng-container",11),l&2){d();let i=D(7);m("ngTemplateOutlet",i)}}function dt(l,c){if(l&1&&(r(0,"option",31),s(1),a()),l&2){let i=c.$implicit;m("value",i),o(),_(i)}}function pt(l,c){if(l&1&&(r(0,"option",31),s(1),a()),l&2){let i=c.$implicit;m("value",i.id),o(),_(i.nom)}}function ut(l,c){if(l&1&&(r(0,"option",39),s(1),a()),l&2){let i=c.$implicit;m("ngValue",i),o(),_(i.nom)}}function ht(l,c){if(l&1&&(r(0,"option",31),s(1),a()),l&2){let i=c.$implicit;m("value",i.id),o(),_(i.nouvelleDevise==null?null:i.nouvelleDevise.labelle)}}function vt(l,c){if(l&1){let i=k();r(0,"c-card",2)(1,"c-card-header")(2,"strong",13),s(3,'Veuillez remplir les informations ci-dessous pour cr\xE9er une nouvelle "facture"'),a()(),r(4,"c-card-body")(5,"c-row",14)(6,"c-col",15),g(),v(7,"svg",16),C(),r(8,"label",17),s(9,"Code"),a(),r(10,"input",18),T("ngModelChange",function(t){p(i);let n=d();return w(n.item.code,t)||(n.item.code=t),u(t)}),f("blur",function(){p(i);let t=d();return u(t.validator.code.validate())}),a(),r(11,"c-form-feedback",19),s(12),a()(),r(13,"c-col",15),g(),v(14,"svg",20),C(),r(15,"label",21),s(16,"Date d'\xE9xperation"),a(),r(17,"input",22),T("ngModelChange",function(t){p(i);let n=d();return w(n.item.dateExperation,t)||(n.item.dateExperation=t),u(t)}),f("blur",function(){p(i);let t=d();return u(t.validator.dateExperation.validate())}),a(),r(18,"c-form-feedback",19),s(19),a()(),r(20,"c-col",15),g(),v(21,"svg",20),C(),r(22,"label",23),s(23,"Date d'\xE9xpedition"),a(),r(24,"input",24),T("ngModelChange",function(t){p(i);let n=d();return w(n.item.dateExpedition,t)||(n.item.dateExpedition=t),u(t)}),f("blur",function(){p(i);let t=d();return u(t.validator.dateExpedition.validate())}),a(),r(25,"c-form-feedback",19),s(26),a()(),r(27,"c-col",15),g(),v(28,"svg",25),C(),r(29,"label",26),s(30,"Remise"),a(),r(31,"input",27),T("ngModelChange",function(t){p(i);let n=d();return w(n.item.rabais,t)||(n.item.rabais=t),u(t)}),f("blur",function(){p(i);let t=d();return u(t.validator.rabais.validate())}),a(),r(32,"c-form-feedback",19),s(33),a()(),r(34,"c-col",15),g(),v(35,"svg",28),C(),r(36,"label",29),s(37,"Type de Remise "),a(),r(38,"select",30),T("ngModelChange",function(t){p(i);let n=d();return w(n.item.typeRabais,t)||(n.item.typeRabais=t),u(t)}),f("blur",function(){p(i);let t=d();return u(t.validator.typeRabais.validate())}),V(39,dt,2,2,"option",31,P),a(),r(41,"c-form-feedback",19),s(42),a()(),r(43,"c-col",15),g(),v(44,"svg",32),C(),r(45,"label",33),s(46,"Taxe"),a(),r(47,"c-input-group")(48,"select",34),T("ngModelChange",function(t){p(i);let n=d();return w(n.taxe.id,t)||(n.taxe.id=t),u(t)}),f("blur",function(){p(i);let t=d();return u(t.validator.taxe.validate())}),V(49,pt,2,2,"option",31,P),a(),r(51,"button",35),f("click",function(){p(i);let t=d();return u(t.navigateToTaxeCreate())}),g(),v(52,"svg",10),a(),C(),r(53,"c-form-feedback",19),s(54),a()()(),r(55,"c-col",15),g(),v(56,"svg",36),C(),r(57,"label",37),s(58,"Client"),a(),r(59,"c-input-group")(60,"select",38),T("ngModelChange",function(t){p(i);let n=d();return w(n.client,t)||(n.client=t),u(t)}),f("blur",function(){p(i);let t=d();return u(t.validator.client.validate())}),V(61,ut,2,2,"option",39,P),a(),r(63,"button",35),f("click",function(){p(i);let t=d();return u(t.navigateToClientCreate())}),g(),v(64,"svg",10),a(),C(),r(65,"c-form-feedback",19),s(66),a()()(),r(67,"c-col",15),g(),v(68,"svg",40),C(),r(69,"label",41),s(70,"Devise"),a(),r(71,"c-input-group")(72,"select",42),T("ngModelChange",function(t){p(i);let n=d();return w(n.devises.id,t)||(n.devises.id=t),u(t)}),f("blur",function(){p(i);let t=d();return u(t.validator.devises.validate())}),V(73,ht,2,2,"option",31,P),a(),r(75,"button",35),f("click",function(){p(i);let t=d();return u(t.navigateToDevisesCreate())}),g(),v(76,"svg",10),a(),C(),r(77,"c-form-feedback",19),s(78),a()()(),r(79,"c-col",15),g(),v(80,"svg",43),C(),r(81,"label",44),s(82,"Entreprise"),a(),v(83,"input",45),a()()()()}if(l&2){let i=d();o(10),E("ngModel",i.item.code),m("valid",i.validator.code.valid),o(),m("valid",!1),o(),_(i.validator.code.message),o(5),E("ngModel",i.item.dateExperation),m("valid",i.validator.dateExperation.valid),o(),m("valid",!1),o(),_(i.validator.dateExperation.message),o(5),E("ngModel",i.item.dateExpedition),m("valid",i.validator.dateExpedition.valid),o(),m("valid",!1),o(),_(i.validator.dateExpedition.message),o(5),E("ngModel",i.item.rabais),m("valid",i.validator.rabais.valid),o(),m("valid",!1),o(),_(i.validator.rabais.message),o(5),E("ngModel",i.item.typeRabais),m("valid",i.validator.typeRabais.valid),o(),I(i.typeRabaisEnumList),o(2),m("valid",!1),o(),_(i.validator.typeRabais.message),o(6),E("ngModel",i.taxe.id),m("valid",i.validator.taxe.valid),o(),I(i.taxeList),o(4),m("valid",!1),o(),_(i.validator.taxe.message),o(6),E("ngModel",i.client),m("valid",i.validator.client.valid),o(),I(i.clientList),o(4),m("valid",!1),o(),_(i.validator.client.message),o(6),E("ngModel",i.devises.id),m("valid",i.validator.devises.valid),o(),I(i.devisesList),o(4),m("valid",!1),o(),_(i.validator.devises.message),o(5),m("value",i.item.entreprise==null?null:i.item.entreprise.nom)}}function _t(l,c){if(l&1){let i=k();r(0,"tr")(1,"td"),s(2),a(),r(3,"td"),s(4),a(),r(5,"td"),s(6),a(),r(7,"td")(8,"input",60),T("ngModelChange",function(t){let n=p(i).$implicit;return w(n.quantite,t)||(n.quantite=t),u(t)}),f("ngModelChange",function(t){let n=p(i).$implicit;return u(n.disponible=n.disponible?n.disponible-t:n.disponible)}),a()(),r(9,"td"),s(10),a(),r(11,"td"),s(12),a(),r(13,"td")(14,"input",61),T("ngModelChange",function(t){let n=p(i).$implicit;return w(n.disque,t)||(n.disque=t),u(t)}),a()(),r(15,"td",62)(16,"button",63),f("click",function(){let t=p(i).$implicit,n=d(2);return u(n.deleteFactureProduit(t))}),g(),v(17,"svg",64),a()()()}if(l&2){let i=c.$implicit,e=d(2);o(2),X(" ",i.produit!=null?i.produit.nom:"null"," "),o(2),_(i==null?null:i.prix),o(2),_(e.calculerTotal(i)),o(2),m("min",0),E("ngModel",i.quantite),o(2),_(i.produit==null||i.produit.taxe==null?null:i.produit.taxe.nom),o(2),_(i.disponible),o(2),E("ngModel",i.disque)}}function ft(l,c){if(l&1&&(r(0,"option",39),s(1),a()),l&2){let i=c.$implicit;m("ngValue",i),o(),_(i.nom)}}function xt(l,c){if(l&1){let i=k();r(0,"c-card",2)(1,"c-card-header")(2,"strong"),s(3,"S\xE9lectionner des produits"),a()(),r(4,"c-card-body")(5,"table",46)(6,"thead",47)(7,"tr")(8,"th",48),s(9,"Produit"),a(),r(10,"th",48),s(11,"Prix"),a(),r(12,"th",48),s(13,"Total"),a(),r(14,"th",48),s(15,"Quantite"),a(),r(16,"th",48),s(17,"Taxe"),a(),r(18,"th",48),s(19,"Disponible"),a(),r(20,"th",48),s(21,"Remise"),a(),r(22,"th",49),s(23,"Actions"),a()()(),r(24,"tbody"),V(25,_t,18,8,"tr",null,P),a()(),r(27,"c-col",50)(28,"c-input-group")(29,"select",51),f("ngModelChange",function(t){p(i);let n=d();return u(n.addFactureProduits(t))}),V(30,ft,2,2,"option",39,P),a()()()()(),r(32,"c-card")(33,"c-input-group")(34,"c-card-body")(35,"c-col",15)(36,"label",52),s(37,"Unit\xE9s total "),a(),v(38,"input",53),r(39,"c-form-feedback",19),s(40),a()(),r(41,"c-col",15)(42,"label",54),s(43,"Remise Global"),a(),v(44,"input",55),a(),r(45,"c-col",15)(46,"label",56),s(47,"Sous total"),a(),v(48,"input",57),r(49,"c-form-feedback",19),s(50),a()(),r(51,"c-col",15)(52,"label",58),s(53,"Total"),a(),v(54,"input",59),r(55,"c-form-feedback",19),s(56),a()()()()()}if(l&2){let i=d();o(5),m("hover",!0)("responsive",!0)("striped",!0),o(20),I(i.factureProduit),o(5),I(i.produitList),o(8),m("value",i.calculerSommeQuantite(i.factureProduit)),o(),m("valid",!1),o(),_(i.validator.totalUnites.message),o(4),m("value",i.calculeRemiseGlobal(i.factureProduit)),o(4),m("value",i.calculerSommeSousTotal(i.factureProduit)),o(),m("valid",!1),o(),_(i.validator.sousTotal.message),o(4),m("value",i.calculerSommeTotale(i.factureProduit)),o(),m("valid",!1),o(),_(i.validator.total.message)}}var bi=(()=>{let c=class c{constructor(){this.sending=!1,this.standAlon=!0,this.toasterService=h(_e),this.router=h(te),this.paiementService=h(We),this.service=h(je),this.taxeService=h($e),this.clientService=h(Be),this.employeService=h(Le),this.devisesService=h(Ue),this.niveauPrixService=h(He),this.entrepriseService=h(Me),this.produitService=h(ze),this.factureProduitService=h(Xe),this.commandeService=h(Ne),this.commandeProduitService=h(Qe),this.formBuilder=h(Fe),this.notificationService=h(De),this.validator=Ye.init(()=>this.item),this.entrepriseSelectedService=h(ke),this.tokenService=h(fe),this.userInfosService=h(Re),this.produitNiveauPrixService=h(Ze),this.TypeRabaisEnum=j,this.iSemploye=this.notificationService.isEmploye,this.paiementGetter=()=>this.paiement,this.paiementSetter=e=>this.paiement=e,this.retourProduitGetter=()=>this.retourProduit,this.retourProduitSetter=e=>this.retourProduit=e,this.addressFacturationGetter=()=>this.addressFacturation,this.addressFacturationSetter=e=>this.addressFacturation=e,this.addressExpeditionGetter=()=>this.addressExpedition,this.addressExpeditionSetter=e=>this.addressExpedition=e,this.typeRabaisEnumList=Object.values(j),this.statutFactureEnumList=Object.values(N)}ngOnChanges(e){this.item.factureProduit?.forEach(t=>{this.calculerTotal(t)})}set setItemGetter(e){this.itemGetter=e,this.standAlon=!1}set setItemSetter(e){this.itemSetter=e}set setValidator(e){this.validator=e}ngOnInit(){if(this.loadEntreprise(),this.service.keepData){let t=this.taxeService.createdItemAfterReturn;t.created&&(this.item.taxe=t.item,this.validator.taxe.validate());let n=this.clientService.createdItemAfterReturn;n.created&&(this.item.client=n.item,this.validator.client.validate());let x=this.devisesService.createdItemAfterReturn;x.created&&(this.item.devises=x.item,this.validator.devises.validate())}else this.reset(!1);this.service.keepData=!1,this.item.addressFacturation=new R,this.item.addressExpedition=new R,this.loadTaxeList(),this.calculerTotal(this.itemFP),this.loadDevisesList(),this.loadNiveauPrixList(),this.loadEntrepriseList(),this.findProduitCommande(),this.loadProduitList(),this.generateCode(),(this.tokenService.getRole()?.some(t=>t=="ADMIN")?1:0)==1?this.getClientsForAdmin():this.getClientsForEmploye()}generateCode(){let e=Math.floor(Math.random()*1e6);this.item.code="F"+e.toString().padStart(6,"0")}loadEntreprise(){this.entrepriseService.findById(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:e=>{this.item.entreprise=e,console.log("entre :",this.item.entreprise)},error:e=>console.log(e)})}loadTaxeList(){this.taxeService.findAll().subscribe({next:e=>this.taxeList=e,error:e=>console.log(e)})}getClientsForAdmin(){this.entrepriseSelectedService.getEntrepriseSelected()!=0?this.clientService.getClients(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:e=>{this.clientList=e,console.log("Clients :",e)},error:e=>console.log(e)}):this.entrepriseService.findByAdmin(this.userInfosService.getUsername()).subscribe(e=>{this.entreprises=e,console.log("Entreprises: ",this.entreprises),this.entreprises&&this.entreprises.length>0?this.clientService.getClients(this.entreprises[0].id).subscribe({next:t=>{this.clientList=t,console.log("Clients :",t)},error:t=>console.log(t)}):console.log("Aucune entreprise trouv\xE9e.")},e=>{console.log(e)})}getClientsForEmploye(){this.entrepriseSelectedService.getEntrepriseSelected()!=0?this.clientService.getClients(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:e=>{this.clientList=e,console.log("Clients :",e)},error:e=>console.log(e)}):this.employeService.findByUserName(this.userInfosService.getUsername()).subscribe(e=>{console.log("empId: ",e.id),this.entrepriseService.findEntreprisesAdroitAcces(e.id).subscribe(t=>{this.entreprises=t,console.log("Entreprises\xC0droit: ",this.entreprises),this.entreprises&&this.entreprises.length>0&&this.clientService.getClients(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:n=>{this.clientList=n,console.log("Clients :",n)},error:n=>console.log(n)})},t=>{console.log(t)})},e=>{console.log(e)})}loadDevisesList(){this.devisesService.findAll().subscribe({next:e=>this.devisesList=e,error:e=>console.log(e)})}loadNiveauPrixList(){this.niveauPrixService.findAll().subscribe({next:e=>this.niveauPrixList=e,error:e=>console.log(e)})}loadEntrepriseList(){this.entrepriseService.findAll().subscribe({next:e=>this.entrepriseList=e,error:e=>console.log(e)})}loadProduitList(){this.produitService.findByEntrepriseId(this.entrepriseSelectedService.getEntrepriseSelected()).subscribe({next:e=>this.produitList=e,error:e=>console.log(e)})}create(){if(this.notificationService.handelcreate("creation d'une facture","Une nouvelle facture \xE0 \xE9t\xE9 cr\xE9e par l'employer",this.entrepriseSelectedService.getEntrepriseSelected()),console.log(this.item),!this.validator.validate()){console.log(this.validator);return}this.sending=!0,this.service.create().subscribe({next:e=>{if(this.sending=!1,e!=null){if(this.item=e,this.toReturn){this.router.navigate([this.returnUrl]).then();return}this.router.navigate(["/ventes/facture/facture/facturepdf"]).then(),this.toasterService.toast({message:"Une nouvelle facture a \xE9t\xE9 ajout\xE9",color:"success"})}},error:e=>{this.sending=!1,console.log(e),this.validator.import(e.error)}})}reset(e=!0){(e||this.item==null)&&(this.item=new $),this.validator.reset()}get items(){return this.service.items}set items(e){this.service.items=e}get item(){return this.itemGetter()}set item(e){this.itemSetter(e)}itemGetter(){return this.service.item}itemSetter(e){this.service.item=e}get paiement(){return this.item.paiement==null&&(this.item.paiement=new Ge),this.item.paiement}set paiement(e){this.item.paiement=e}get retourProduit(){return this.item.retourProduit==null&&(this.item.retourProduit=new Je),this.item.retourProduit}set retourProduit(e){this.item.retourProduit=e}get addressFacturation(){return this.item.addressFacturation==null&&(this.item.addressFacturation=new R),this.item.addressFacturation}set addressFacturation(e){this.item.addressFacturation=e}generateDocument(){this.service.generateDocument().subscribe({next:e=>console.log("success"),error:e=>console.log(e)})}get addressExpedition(){return this.item.addressExpedition==null&&(this.item.addressExpedition=new R),this.item.addressExpedition}set addressExpedition(e){this.item.addressExpedition=e}get taxe(){return this.item.taxe==null&&(this.item.taxe=new O),this.item.taxe}set taxe(e){this.item.taxe=e}get taxeExpedition(){return this.item.taxeExpedition==null&&(this.item.taxeExpedition=new O),this.item.taxeExpedition}set taxeExpedition(e){this.item.taxeExpedition=e}get client(){return this.item.client==null&&(this.item.client=new Ae),this.item.client}set client(e){this.item.client=e}get devises(){return this.item.devises==null&&(this.item.devises=new qe),this.item.devises}set devises(e){this.item.devises=e}get niveauPrix(){return this.item.niveauPrix==null&&(this.item.niveauPrix=new Oe),this.item.niveauPrix}set niveauPrix(e){this.item.niveauPrix=e}get entreprise(){return this.item.entreprise==null&&(this.item.entreprise=new Ie),this.item.entreprise}set entreprise(e){this.item.entreprise=e}get factureProduit(){return this.item.factureProduit==null&&(this.item.factureProduit=[]),this.item.factureProduit}set factureProduit(e){this.item.factureProduit=e}updateDisponible(e){let t=e?.produit?.niveauStockInitial??0,n=e.quantite??0;return t===0||n===0?0:t-n}addFactureProduits(e){console.log(e),this.item.factureProduit==null&&(this.item.factureProduit=[]);let t=new Ke;t.produit=e,t.disque=0,t.quantite=0,e.disponible=e?.niveauStockInitial-t?.quantite,t.disponible=e.disponible,t.prix=e?.produitNiveauPrix?.filter(n=>n.niveauPrix?.id==this.client?.niveauPrix?.id)[0]?.prix||e.prixGros,t.total=this.calculerTotal(t),this.item.factureProduit=[...this.item.factureProduit,t],console.log(this.item.factureProduit)}get returnUrl(){return this.service.returnUrl}get toReturn(){return this.service.toReturn()}navigateToTaxeCreate(){this.taxeService.returnUrl=this.router.url,this.service.keepData=!0,this.router.navigate(["/parametres/taxe/create"]).then()}navigateToClientCreate(){this.clientService.returnUrl=this.router.url,this.service.keepData=!0,this.router.navigate(["/contacts/client/create"]).then()}navigateToDevisesCreate(){this.devisesService.returnUrl=this.router.url,this.service.keepData=!0,this.router.navigate(["/parametres/devises/create"]).then()}navigateToNiveauPrixCreate(){this.niveauPrixService.returnUrl=this.router.url,this.service.keepData=!0,this.router.navigate(["/parametres/niveau-prix/create"]).then()}navigateToEntrepriseCreate(){this.entrepriseService.returnUrl=this.router.url,this.service.keepData=!0,this.router.navigate(["/parametres/entreprise/create"]).then()}navigateToFactureAutre(){this.service.returnUrl=this.router.url,this.service.keepData=!0,this.router.navigate(["/ventes/facture/create"]).then()}cancel(){this.item=new $}retour(){this.router.navigate(["/pays/pays/list"]).then()}deleteFactureProduit(e){e.produit&&(e.produit.disponible=e.produit.disponible+e.quantite),this.item.factureProduit=this.item.factureProduit?.filter(t=>t!==e)}calculerTotal(e){if(console.log(this.item),e.produit){let t=e.prix||0;console.log("Produit Niveau Prix:",e.produit),e.produit.produitNiveauPrix?.forEach(S=>{console.log("Niveau de Prix ID:",S.niveauPrix?.id),console.log("Client Niveau Prix ID:",this.item.client?.niveauPrix?.id),this.item.client?.niveauPrix?.id==S.niveauPrix?.id?(console.log("Niveau de prix trouv\xE9..."),t=S.prix):console.log("Niveau de prix introuvable...")}),console.log("prixProduit",t);let n=e.quantite*t,x=e.produit.taxe?e.produit.taxe.tauxImposition:0,b=0;if(this.item.typeRabais!=null&&this.item.typeRabais==this.TypeRabaisEnum.POURCENTAGE){let S=n*(1+x/100),y=S*(e.disque/100);b=S-y}else if(this.item.typeRabais!=null&&this.item.typeRabais==this.TypeRabaisEnum.MONTANT){let S=n*(1+x/100),y=e.disque;b=S-y}return b*=e.quantite||1,b-=e.disque||0,b=parseFloat(b.toFixed(2)),e.total=b,b}return console.log("Produit non trouv\xE9..."),0}calculerSommeQuantite(e){let t=e.reduce((n,x)=>n+(x.quantite||0),0);return this.item.totalUnites=t,t}calculeRemiseGlobal(e){let t=e.reduce((n,x)=>n+(x.disque||0),0);return this.item.remiseGlobal=t+this.item.rabais,this.item.remiseGlobal}calculerSommeSousTotal(e){let t=e.reduce((n,x)=>x?.quantite&&x?.prix?n+x.quantite*x.prix:n,0);return this.item.sousTotal=t,t.toFixed(2)}calculerSommeTotale(e){let t=e.reduce((y,M)=>{let Q=this.calculerTotal(M);return console.log(`Total pour ${M.produit?.nom}: ${Q}`),y+Q},0),n=this.taxeList?.filter(y=>y.id==this.item.taxe?.id)[0]?.tauxImposition,x=this.item.taxeExpedition?.tauxImposition!=null?this.item.taxeExpedition.tauxImposition:0,b=0;if(this.item.typeRabais!=null&&this.item.typeRabais==this.TypeRabaisEnum.POURCENTAGE){let y=t*(1+(n+x)/100),M=y*(this.item.rabais/100);b=y-M}if(this.item?.typeRabais!=null&&this.item?.typeRabais==this.TypeRabaisEnum.MONTANT){let y=t*(1+(n+x)/100),M=this.item.rabais;b=y-M}let S=parseFloat(b.toFixed(2));return console.log(`Somme totale format\xE9e: ${S}`),this.item.total=S,S}get itemFP(){return this.factureProduitService.item}set itemFP(e){this.factureProduitService.item=e}get itemP(){return this.produitService.item}set itemP(e){this.produitService.item=e}totalPayer(){this.item.total===this.item.paiement?.montantPaye?this.item.statut=N.PAYE:this.item.statut=N.NONPAYE}set itemsC(e){this.commandeService.items=e}get itemC(){return this.commandeService.item}set itemC(e){this.commandeService.item=e}findByCommandeId(){let e=this?.item?.commande?.id;e!==void 0?this.commandeService.findById(e).subscribe({next:t=>{this.item.commande=t},error:t=>{console.log(t)}}):console.log("Commande ID is undefined")}set itemsCommandeProduits(e){this.commandeProduitService.items=e}get itemCommandeProduit(){return this.commandeProduitService.item}set itemCommandeProduit(e){this.commandeProduitService.item=e}findProduitCommande(){this.commandeProduitService.findById(this.itemCommandeProduit.id).subscribe({next:e=>this.itemCommandeProduit=e,error:e=>console.log(e)})}};c.\u0275fac=function(t){return new(t||c)},c.\u0275cmp=J({type:c,selectors:[["app-facture-create"]],inputs:{setItemGetter:[0,"getter","setItemGetter"],setItemSetter:[0,"setter","setItemSetter"],setValidator:[0,"validator","setValidator"]},standalone:!0,features:[K,Z],decls:10,vars:2,consts:[["createFrom",""],["factureProduitCreate",""],[1,"mb-3"],[1,"hstack","gap"],[1,"p-2"],[1,"p-2","ms-auto"],["cButton","","color","secondary","variant","outline","routerLink","/ventes/facture/facture",3,"click"],["cButton","","color","dark",3,"click"],["cButton","","color","primary",3,"click"],["aria-hidden","true","size","sm"],["cIcon","","name","cilPlus"],[4,"ngTemplateOutlet"],["cButton","","color","secondary",3,"click","routerLink"],[2,"color","#1d0528","font-family","'Times New Roman'","font-size","21px","margin-left","300px"],[1,"g-3"],["sm","4"],["cIcon","","name","cil-barcode",2,"color","blue","font-size","30px"],["cLabel","","for","code",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","code","type","text","placeholder","Code","name","code",3,"ngModelChange","blur","ngModel","valid"],[3,"valid"],["cIcon","","name","cil-calendar",2,"color","blue","font-size","30px"],["cLabel","","for","dateExperation",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","dateExperation","type","date","placeholder","DateExperation","name","dateExperation",3,"ngModelChange","blur","ngModel","valid"],["cLabel","","for","dateExpedition",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","dateExpedition","type","date","placeholder","DateExpedition","name","dateExpedition",3,"ngModelChange","blur","ngModel","valid"],["cIcon","","name","cil-sort-descending",2,"color","blue","font-size","30px"],["cLabel","","for","rabais",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","rabais","type","number","placeholder","Rabais","name","rabais",3,"ngModelChange","blur","ngModel","valid"],["cIcon","","name","cil-tags",2,"color","blue","font-size","30px"],["cLabel","","for","typeRabais",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cSelect","","id","typeRabais","name","typeRabais",3,"ngModelChange","blur","ngModel","valid"],[3,"value"],["cIcon","","name","cil-sort-ascending",2,"color","blue","font-size","30px"],["cLabel","","for","taxe",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cSelect","","id","taxe","name","taxe",3,"ngModelChange","blur","ngModel","valid"],["cButton","","color","secondary","type","button","variant","outline",3,"click"],["cIcon","","name","cilUser",2,"color","blue","font-size","30px"],["cLabel","","for","client",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cSelect","","id","client","name","client",3,"ngModelChange","blur","ngModel","valid"],[3,"ngValue"],["cIcon","","name","cil-dollar",2,"color","blue","font-size","30px"],["cLabel","","for","devises",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cSelect","","id","devises","name","devises",3,"ngModelChange","blur","ngModel","valid"],["cIcon","","name","cil-building",2,"color","blue","font-size","30px"],["cLabel","","for","entreprise",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","entreprise","type","text","name","entreprise","disabled","true",3,"value"],["align","middle","cTable","",1,"mb-0","border",3,"hover","responsive","striped"],[1,"text-nowrap","text-truncate"],[1,"bg-body-tertiary"],[1,"bg-body-tertiary",2,"display","flex","justify-content","end"],["sm","3",1,"mt-3"],["cSelect","","ngModel","",3,"ngModelChange"],["cLabel","","for","qte",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","qte","type","number","readonly","","name","qte",3,"value"],["cLabel","","for","sommeRemise",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","sommeRemise","type","number","readonly","","name","sommeRemise",3,"value"],["cLabel","","for","stotal",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","stotal","type","number","readonly","","name","stotal",3,"value"],["cLabel","","for","total",2,"color","black","font-family","'Times New Roman'","font-size","18px","font-weight","bold"],["cFormControl","","id","total","type","number","readonly","","name","total",3,"value"],["type","number",3,"ngModelChange","min","ngModel"],["type","number",3,"ngModelChange","ngModel"],[2,"display","flex","justify-content","end"],["cButton","","color","",3,"click"],["cIcon","","name","cil-trash","size","lg"]],template:function(t,n){t&1&&(F(0,st,16,4),A(1,0,tt),F(3,mt,1,1),A(4,3,it),F(6,vt,84,33,"ng-template",null,0,W)(8,xt,57,13,"ng-template",null,1,W)),t&2&&(o(),B(n.standAlon),o(3),B(!n.standAlon))},dependencies:[se,U,de,me,Pe,Ee,we,ge,Se,ye,Ce,Te,be,ce,re,ne,ae,le,q,z,oe,ve]});let l=c;return l})();export{bi as a};
